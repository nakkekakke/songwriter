(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{108:function(e,t,n){e.exports=n(143)},113:function(e,t,n){},143:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(9),c=n.n(o),i=(n(113),n(29)),l=n(34),u=n(175),s=n(177),d=n(95),m=n(178),f=n(173),p=Object(f.a)((function(){return{root:{flexGrow:1},title:{fontSize:20,paddingRight:15},buttonsDiv:{flex:1},linkButton:{textDecoration:"none",color:"white",padding:20}}})),g=function(){var e=p();return r.a.createElement("div",{className:e.root},r.a.createElement(u.a,{position:"static"},r.a.createElement(s.a,null,r.a.createElement(d.a,{className:e.title},"SongWriter"),r.a.createElement("div",{className:e.buttonsDiv},r.a.createElement(m.a,{component:l.Link,to:"/songs/",color:"inherit",className:e.linkButton},"Your songs")),r.a.createElement(m.a,{color:"inherit",className:e.logout},"Logout"))))},E=n(185),v=n(13),h=n(180),b=n(179),O=Object(f.a)((function(){return{item:{}}})),S=function(e){var t=e.song,n=O();return r.a.createElement(b.a,{component:l.Link,to:"/songs/".concat(t.id),divider:!0,className:n.item},r.a.createElement("h2",null,t.title))},j=n(19),y=n(181),w=n(23),N=function(e){var t=e.match(/[^\r\n]+/g);return t||[]},C=function(){return{title:"New song",sections:[{id:1,name:"New section",lines:[]}]}},k=function(e){for(var t="",n=0;n<e.length;n++)t=t.concat(e[n]),n+1<e.length&&(t=t.concat("\n"));return t},x=function(e){return N(e).map((function(e){return e.trim()})).filter((function(e){return""!==e}))},I=C,T=function(e){if(0===e.sections.length)return e.sections=[{id:1,name:"New section",lines:[]}],e;var t=e.sections.map((function(e){return e.id})).reduce((function(e,t){return t>e?t:e})),n=Object(w.a)(Object(w.a)({},{id:1,name:"New section",lines:[]}),{},{id:t+1});return e.sections.push(n),e},D=n(10),B=n.n(D),A=n(18),_=n(49),G=n.n(_),L="/api/songs/",M={getAll:function(){var e=Object(A.a)(B.a.mark((function e(){var t;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Getting songs..."),e.next=3,G.a.get(L);case 3:return t=e.sent,e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getOne:function(){var e=Object(A.a)(B.a.mark((function e(t){var n;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.a.get(L+t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),create:function(){var e=Object(A.a)(B.a.mark((function e(t){var n;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Creating new song..."),e.next=3,G.a.post(L,t);case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),edit:function(){var e=Object(A.a)(B.a.mark((function e(t){var n;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.a.put(L+t.id,t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),destroy:function(){var e=Object(A.a)(B.a.mark((function e(t){var n;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Deleting song with id:",t),e.next=3,G.a.delete(L+t);case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},R=function(e,t){return function(){var n=Object(A.a)(B.a.mark((function n(a){return B.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a({type:"EDIT_SECTION",data:{songId:e,section:t}});case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},W=function(e){return function(){var t=Object(A.a)(B.a.mark((function t(n){var a;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,M.edit(e);case 3:a=t.sent,n({type:"EDIT_SONG",data:a}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"INIT_SONGS":return t.data;case"CREATE_SONG":var n=e.concat(t.data);return n;case"EDIT_SONG":var a=t.data.id;return e.map((function(e){return e.id!==a?e:t.data}));case"DELETE_SONG":return e.filter((function(e){return e.id!==t.data.id}));case"EDIT_SECTION":var r=t.data.songId,o=t.data.section.id,c=e.find((function(e){return e.id===r})),i=c.sections.map((function(e){return e.id!==o?e:t.data.section}));return e.map((function(e){return e.id!==r?e:Object(w.a)(Object(w.a)({},c),{},{sections:i})}));case"DELETE_SECTION":var l=t.data.songId,u=t.data.section.id,s=e.find((function(e){return e.id===l})),d=s.sections.filter((function(e){return e.id!==u}));return e.map((function(e){return e.id!==l?e:Object(w.a)(Object(w.a)({},s),{},{sections:d})}));default:return e}},J=Object(f.a)((function(){return{root:{},addSongButton:{margin:8}}})),F=function(){var e=J(),t=Object(j.c)((function(e){return e.songs})),n=Object(j.b)(),a=Object(v.k)();console.log("Rendered",t.length,"songs");return r.a.createElement("div",{className:e.root},r.a.createElement("h1",null,"Songs"),r.a.createElement(h.a,null,0!==t.length?t.map((function(e){return r.a.createElement(S,{key:e.id,to:"/songs/".concat(e.id),song:e})})):r.a.createElement("p",null,"No songs found")),r.a.createElement(m.a,{className:e.addSongButton,variant:"contained",color:"primary",startIcon:r.a.createElement(y.a,null),onClick:function(){var e;n((e=I(),function(){var t=Object(A.a)(B.a.mark((function t(n){var a;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,M.create(e);case 3:return a=t.sent,console.log("Created:",a),n({type:"CREATE_SONG",data:a}),t.abrupt("return",a);case 9:t.prev=9,t.t0=t.catch(0),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}())).then((function(e){a.push("/songs/"+e.id),console.log("Redirected!")})).catch((function(e){return console.log("Error creating new song:",e)}))}},"New song"))},V=n(194),z=n(198),P=n(188),Y=n(189),q=n(190),K=n(191),Q=n(192),U={},X=function(e){return console.log("Saving snapshot:",e),function(t){t({type:"SAVE_SNAPSHOT",data:e})}},Z=function(){return console.log("Resetting snapshot"),function(e){e({type:"RESET_SNAPSHOT"})}},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SAVE_SNAPSHOT":return t.data;case"RESET_SNAPSHOT":return U;default:return e}},ee=n(93),te=n(195),ne=n(182),ae=n(54),re=n(183),oe=Object(f.a)((function(e){return{section:{borderWidth:2,borderStyle:"solid",borderRadius:5,borderColor:e.palette.primary.main,padding:20,marginBottom:3,overflow:"auto",whiteSpace:"nowrap",backgroundColor:"#fff"},normalViewRoot:{marginTop:-12,marginBottom:-15},line:{marginTop:-5},editForm:{marginBottom:15},nameField:{marginBottom:10},bottomDiv:{display:"flex"},lineSubmitButton:{marginTop:10,marginBottom:-25},deleteButton:{marginTop:10,marginBottom:-25,marginLeft:"auto"},dragHandle:{marginLeft:"auto",marginTop:10,marginBottom:-25}}})),ce=function(e){var t=e.songId,n=e.sectionId,o=e.editMode,c=Object(a.useState)(!1),l=Object(i.a)(c,2),u=l[0],s=l[1],d=oe(),f=Object(j.b)(),p=Object(ae.c)((function(){return r.a.createElement(te.a,{className:d.dragHandle}," ",r.a.createElement(ne.a,null,r.a.createElement(re.a,null))," ")})),g=Object(j.c)((function(e){return e.songs.find((function(e){return e.id===t})).sections.find((function(e){return e.id===n}))})),E=function(e){var n=Object(w.a)(Object(w.a)({},g),{},{lines:Object(ee.a)(g.lines),name:e.target.value});f(R(t,n))},v=function(e){var n=x(e.target.value),a=Object(w.a)(Object(w.a)({},g),{},{lines:n});f(R(t,a))},h=function(e){e.preventDefault(),console.log("Delete button pressed!"),u?(console.log("Delete for realz"),f(function(e,t){return function(){var n=Object(A.a)(B.a.mark((function n(a){return B.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a({type:"DELETE_SECTION",data:{songId:e,section:t}});case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(t,g))):s(!0)};return r.a.createElement("div",{className:d.section},o?r.a.createElement("form",{className:d.editForm},r.a.createElement(V.a,{className:d.nameField,label:"Edit name",name:"name",defaultValue:g.name,onChange:E}),r.a.createElement("div",null,r.a.createElement(V.a,{multiline:!0,label:"Lines",name:"lines",rows:g.lines.size,defaultValue:k(g.lines),onChange:v,fullWidth:!0})),r.a.createElement("div",{className:d.bottomDiv},r.a.createElement(p,null),r.a.createElement(m.a,{className:d.deleteButton,size:"small",color:"secondary",variant:"outlined",onClick:h},u?"Confirm deletion":"Delete"))):r.a.createElement("div",{className:d.normalViewRoot},r.a.createElement("h2",null,g.name),g.lines.map((function(e,t){return r.a.createElement("p",{className:d.line,key:t},e)}))))},ie=n(89),le=n.n(ie),ue=Object(f.a)((function(){return{root:{}}})),se=Object(ae.b)((function(e){var t=e.section,n=e.song,a=e.editMode;return r.a.createElement(ce,{songId:n.id,sectionId:t.id,editMode:a})})),de=Object(ae.a)((function(e){var t=e.song,n=e.editMode;return r.a.createElement(E.a,{maxWidth:!1,align:"left"},t.sections.map((function(e,a){return r.a.createElement(se,{key:e.id,index:a,section:e,song:t,editMode:n})})))})),me=function(e){var t=e.song,n=e.editMode,a=Object(j.b)(),o=(ue(),function(e){var n=e.oldIndex,r=e.newIndex,o=le()(t.sections,n,r);a(function(e,t){var n=JSON.parse(JSON.stringify(e));return n.sections=t,function(){var e=Object(A.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"EDIT_SONG",data:n});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(t,o))});return 0===t.sections.length?r.a.createElement(E.a,null,r.a.createElement("h2",null,"No sections")):r.a.createElement(de,{song:t,editMode:n,onSortEnd:o,useDragHandle:!0,useWindowAsScrollContainer:!0})},fe=n(68),pe=n.n(fe),ge=n(90),Ee=n.n(ge),ve=n(186),he=n(187),be=Object(f.a)((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),Oe=function(e){var t=e.onClick,n=be();return r.a.createElement(ve.a,{className:n.closeButton,onClick:t},r.a.createElement(he.a,null))},Se=function(e){var t=e.handleSaveAgreeClick,n=e.handleSaveDiscardClick,a=e.unsavedChanges,o=function(e){return function(){t(),e()}},c=function(e){return function(){n(),e()}};return r.a.createElement(Ee.a,{when:a()},(function(e){return function(e,t,n){return r.a.createElement(z.a,{open:e,onClose:t},r.a.createElement(P.a,null,"You have unsaved changes"),r.a.createElement(Y.a,null,r.a.createElement(q.a,null,"If you leave without saving, all changes will be lost!")),r.a.createElement(K.a,null,r.a.createElement(m.a,{onClick:o(n),color:"primary",variant:"contained"},"Save and leave"),r.a.createElement(m.a,{onClick:c(n),color:"secondary",variant:"contained"},"Leave without saving"),r.a.createElement(Oe,{onClick:t})))}(e.isActive,e.onCancel,e.onConfirm)}))},je=Object(f.a)((function(e){return{root:{},menuContainer:{marginBottom:e.spacing(1)},editModeButton:{marginLeft:e.spacing(1)},titleField:{margin:15},addSectionButton:{marginTop:e.spacing(1)},deleteSongButton:{marginLeft:"auto"},dialogCloseButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),ye=function(e){e.setAlertMessage,e.setAlertIsError;var t=Object(a.useState)(!1),n=Object(i.a)(t,2),o=n[0],c=n[1],l=Object(a.useState)(!1),u=Object(i.a)(l,2),s=u[0],d=u[1],f=Object(a.useState)(!1),p=Object(i.a)(f,2),g=p[0],h=p[1],b=Object(a.useState)(!1),O=Object(i.a)(b,2),S=O[0],w=O[1],N=je(),C=Object(v.m)().id,k=Object(j.b)(),x=Object(v.k)(),I=Object(j.c)((function(e){return e.songs.find((function(e){return e.id===C}))})),D=Object(j.c)((function(e){return e.snapshot}));console.log("Song render:",I);var _=function(){k(X(I)),k(W(I))},G=function(){o?R():L()},L=function(){k(X(I)),c(!0)},R=function(){console.log("Exiting edit mode"),ee()?h(!0):(c(!1),k(Z()))},H=function(){console.log("Saving!"),h(!1),c(!1),k(Z()),k(W(I))},J=function(){console.log("Discarding changes!"),h(!1),c(!1),k(Z()),k(function(e){return function(){var t=Object(A.a)(B.a.mark((function t(n){return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:"EDIT_SONG",data:e});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(D)),console.log("Snapshot after reset:",D)},F=function(e){""===e.target.value?w(!0):S&&w(!1),k(function(e,t){var n=JSON.parse(JSON.stringify(e));return n.title=t,function(){var e=Object(A.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"EDIT_SONG",data:n});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(I,e.target.value))},U=function(){console.log("Add new section!"),k(function(e){var t=JSON.parse(JSON.stringify(e));return t=T(t),function(){var e=Object(A.a)(B.a.mark((function e(n){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:"EDIT_SONG",data:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}(I))},$=function(){console.log("Deleting song here"),k(function(e){return function(){var t=Object(A.a)(B.a.mark((function t(n){var a;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,M.destroy(e.id);case 3:a=t.sent,console.log("Destroy returned:",a),n({type:"DELETE_SONG",data:e}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()}(I)),x.push("/songs/")},ee=function(){return!pe.a.isEmpty(D)&&!pe.a.isEqual(D,I)};return I?r.a.createElement("div",{className:N.root},o?r.a.createElement(V.a,{error:S,className:N.titleField,label:"Edit title",defaultValue:I.title,onChange:F,helperText:S?"Title cannot be empty!":""}):r.a.createElement("h1",null,I.title),r.a.createElement("div",null,r.a.createElement(E.a,{align:"right",maxWidth:!1,className:N.menuContainer},function(){if(ee())return r.a.createElement(m.a,{color:"primary",variant:"outlined",onClick:_},"Save changes")}(),r.a.createElement(m.a,{color:"primary",variant:"contained",onClick:G,className:N.editModeButton},o?"Exit edit mode":"Edit mode")),r.a.createElement(me,{song:I,editMode:o})),r.a.createElement(E.a,{maxWidth:!1},o?r.a.createElement(m.a,{className:N.addSectionButton,variant:"contained",color:"primary",startIcon:r.a.createElement(y.a,null),onClick:U},"New section"):r.a.createElement("div",null)),r.a.createElement(E.a,{align:"right",maxWidth:!1},o?r.a.createElement(m.a,{className:N.deleteSongButton,variant:"contained",color:"secondary",startIcon:r.a.createElement(Q.a,null),onClick:function(){return d(!0)}},"Delete song"):r.a.createElement("div",null)),r.a.createElement(z.a,{open:s,onClose:function(){return d(!1)}},r.a.createElement(P.a,null,"Delete this song?"),r.a.createElement(Y.a,null,r.a.createElement(q.a,null,"Once deleted, this song cannot be restored (not even by discarding changes when exiting Edit Mode).")),r.a.createElement(K.a,null,r.a.createElement(m.a,{onClick:$,color:"secondary",variant:"contained"},"Delete permanently"),r.a.createElement(m.a,{onClick:function(){return d(!1)},variant:"contained"},"Cancel"))),r.a.createElement(z.a,{open:g,onClose:function(){return h(!1)}},r.a.createElement(P.a,null,"Save changes?"),r.a.createElement(Y.a,null,r.a.createElement(q.a,null,"Save or discard the changes you have made.")),r.a.createElement(K.a,null,r.a.createElement(m.a,{onClick:H,color:"primary",variant:"contained"},"Save changes"),r.a.createElement(m.a,{onClick:J,color:"secondary",variant:"contained"},"Discard changes"),r.a.createElement(Oe,{onClick:function(){return h(!1)}}))),r.a.createElement(Se,{handleSaveAgreeClick:H,handleSaveDiscardClick:J,unsavedChanges:ee})):r.a.createElement("div",null,r.a.createElement("h1",null,"Loading"),r.a.createElement("p",null,"Check the url if it takes too long"))},we=n(199),Ne=n(196),Ce=function(e){var t=e.message,n=e.isError,a=e.handleClose;return r.a.createElement("div",null,r.a.createElement(we.a,{open:""!==t,autoHideDuration:5e3,onClose:a},r.a.createElement(Ne.a,{variant:"filled",onClose:a,severity:n?"error":"success"},t)))},ke=Object(f.a)((function(){return{mainContainer:{justifyContent:"center",alignItems:"center",padding:20},contentContainer:{}}})),xe=function(){console.log("App render");var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(!1),u=Object(i.a)(c,2),s=u[0],d=u[1],m=ke(),f=Object(j.b)();Object(a.useEffect)((function(){console.log("App effect"),f(function(){var e=Object(A.a)(B.a.mark((function e(t){var n;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.getAll();case 3:n=e.sent,console.log("Initialized:",n),t({type:"INIT_SONGS",data:n}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}())}),[f]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.BrowserRouter,null,r.a.createElement(g,null),r.a.createElement(E.a,{maxWidth:!1,className:m.mainContainer},r.a.createElement(E.a,{maxWidth:!1,align:"center",className:m.contentContainer},r.a.createElement(v.g,null,r.a.createElement(v.d,{path:"/songs/:id"},r.a.createElement(ye,{setAlertMessage:o,setAlertIsError:d})),r.a.createElement(v.d,{path:"/songs/"},r.a.createElement(F,null)),r.a.createElement(v.d,{path:"/"},r.a.createElement("p",null,"Welcome")))),r.a.createElement(Ce,{message:n,isError:s,handleClose:function(e,t){"clickaway"!==t&&o("")}}))))},Ie=n(193),Te=n(45),De=n(91),Be=n(92),Ae=Object(Be.composeWithDevTools)({trace:!0}),_e=Object(Te.combineReducers)({songs:H,snapshot:$}),Ge=Object(Te.createStore)(_e,Ae(Object(Te.applyMiddleware)(De.a)));c.a.render(r.a.createElement(Ie.a,null,r.a.createElement(j.a,{store:Ge},r.a.createElement(xe,null))),document.getElementById("root"))}},[[108,1,2]]]);
//# sourceMappingURL=main.8e93ea40.chunk.js.map