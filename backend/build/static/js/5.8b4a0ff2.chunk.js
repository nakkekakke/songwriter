(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[5],{182:function(e,t,n){"use strict";var a=n(0),r=n.n(a),c=n(164),o=n(168),l=Object(c.a)((function(){return{header:{marginTop:30}}}));t.a=function(e){var t=e.text,n=l();return r.a.createElement(o.a,{component:"h1",variant:"h4",className:n.header},t)}},190:function(e,t,n){"use strict";var a=n(4),r=n.n(a),c=n(9),o=n(39),l=n.n(o),i=n(62),u="/api/users",s=function(){var e=Object(c.a)(r.a.mark((function e(t,n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.post(u,{username:t,password:n});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(c.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.post(u+"/username-available",{username:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(c.a)(r.a.mark((function e(t,n){var a,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.map((function(e){return e.id})),e.next=3,l.a.put(u+"/songs",{username:t,songIds:a},{headers:Object(i.a)()});case 3:return c=e.sent,e.abrupt("return",c.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.a={create:s,usernameAvailable:m,editSongs:d}},191:function(e,t,n){"use strict";var a=n(0),r=n.n(a),c=n(236),o=n(237),l=n(168),i=n(164),u=n(234),s=n(19),m=n(23),d=n(178),g=n(12),f=function(e){var t=e.loggedIn,n=Object(s.b)(),a=Object(d.k)();return r.a.createElement(u.a,{color:"inherit",onClick:function(){t&&(n(Object(m.e)()),n(Object(g.d)(g.a.logout))),a.push("/")}},t?"Log out":"Log in")},E=n(179),b=Object(i.a)((function(){return{navButton:{textDecoration:"none",color:"white",padding:20}}})),p=function(e){var t=e.path,n=e.text,a=e.onClick,c=b();return r.a.createElement(u.a,{component:E.Link,to:t,onClick:a,color:"inherit",className:c.navButton},n)},v=Object(i.a)((function(){return{root:{flex:1}}})),h=function(e){var t=e.loggedIn,n=v();return r.a.createElement("div",{className:n.root},t?r.a.createElement(p,{path:"/songs/",text:"Your songs"}):void 0)},O=n(235),j=n(259),C=n(60),k=function(){var e=Object(s.b)(),t=Object(s.c)((function(e){return e.statuses.darkMode}));return r.a.createElement(O.a,{control:r.a.createElement(j.a,{checked:t,onChange:function(){return e(Object(C.d)())},color:"secondary"}),label:"Dark theme",labelPlacement:"top",style:{margin:6,marginRight:30}})},S=Object(i.a)((function(){return{root:{flexGrow:1},title:{fontSize:20,paddingRight:15}}}));t.a=function(e){var t=e.loggedIn,n=S();return r.a.createElement("div",{className:n.root},r.a.createElement(c.a,{position:"static"},r.a.createElement(o.a,null,r.a.createElement(l.a,{className:n.title},"SongWriter"),r.a.createElement(h,{loggedIn:t}),r.a.createElement(k,null),r.a.createElement(f,{loggedIn:t}))))}},254:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(191),o=n(164),l=n(166),i=n(179),u=n(178),s=n(4),m=n.n(s),d=n(9),g=n(244),f=n(234),E=n(19),b=n(249),p=n(53),v=n(55),h=n(182),O=n(185),j=n(253),C=n(247),k=n(246),S=n(168),y=n(184),N=n(172),w=n(221),x=n(245),R=n(243),T=n(257),I=n(239),B=n(240),D=n(241),L=n(242),_=function(e){var t=e.open,n=e.setOpen,a=e.handleConfirmClick;return r.a.createElement(T.a,{open:t,onClose:function(){return n(!1)}},r.a.createElement(I.a,null,"Delete this song?"),r.a.createElement(B.a,null,r.a.createElement(D.a,null,"Once deleted, this song cannot be restored.")),r.a.createElement(L.a,null,r.a.createElement(f.a,{onClick:a,color:"secondary",variant:"contained"},"Delete permanently"),r.a.createElement(f.a,{onClick:function(){return n(!1)},variant:"contained"},"Cancel")))},A=Object(o.a)((function(){return{menu:{"& .MuiPaper-root":{}}}})),W=function(e){var t=e.song,n=Object(a.useState)(null),c=Object(y.a)(n,2),o=c[0],l=c[1],i=Object(a.useState)(!1),u=Object(y.a)(i,2),s=u[0],m=u[1],d=A(),g=Object(E.b)(),b=Object(E.c)((function(e){return e.auth.user})),p=function(){l(null)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{onClick:function(e){l(e.target)}},r.a.createElement(R.a,null)),r.a.createElement(w.a,{elevation:1,anchorEl:o,keepMounted:!0,open:null!==o,onClose:p,className:d.menu},r.a.createElement(x.a,null,r.a.createElement(f.a,{variant:"outlined",color:"primary",onClick:function(){g(Object(v.c)(t,b.username)),p()}},"Clone")),r.a.createElement(x.a,null,r.a.createElement(f.a,{variant:"outlined",color:"secondary",onClick:function(){m(!0),p()}},"Delete"))),r.a.createElement(_,{open:s,setOpen:m,handleConfirmClick:function(){g(Object(v.g)(t))}}))},M=n(248),F=Object(o.a)((function(){return{item:{},container:{display:"flex",justifyContent:"space-between"},title:{textAlign:"left",marginTop:8,marginBottom:8},menu:{}}})),z=Object(O.c)((function(){return r.a.createElement(j.a,{style:{marginTop:18,marginLeft:-12}}," ",r.a.createElement(C.a,null,r.a.createElement(M.a,null))," ")})),V=function(e){var t=e.song,n=F();return r.a.createElement(l.a,{maxWidth:"xl",className:n.container},r.a.createElement(z,null),r.a.createElement(k.a,{component:i.Link,to:"/songs/".concat(t.id),divider:!0,className:n.item},r.a.createElement(S.a,{variant:"h6",className:n.title},t.title)),r.a.createElement(W,{song:t,className:n.menu}))},G=Object(O.b)((function(e){var t=e.song;return r.a.createElement(V,{song:t})})),H=Object(O.a)((function(e){var t=e.songs;return r.a.createElement(l.a,{maxWidth:!1,align:"left"},t.map((function(e,t){return r.a.createElement(G,{key:e.id,index:t,song:e})})))})),Y=n(200),J=n.n(Y),K=n(190),P=n(12),q=Object(o.a)((function(){return{list:{marginTop:10},addSongButton:{margin:8}}})),Q=function(){var e=q(),t=Object(E.c)((function(e){return e.songs})),n=Object(E.c)((function(e){return e.auth.user})),a=Object(E.b)(),c=Object(u.k)();console.log("Rendered",t.length,"songs");var o=function(){var e=Object(d.a)(m.a.mark((function e(r){var c,o,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=r.oldIndex,o=r.newIndex,l=J()(t,c,o),console.log("Sort ended"),a(Object(v.n)(l)),e.prev=4,e.next=7,K.a.editSongs(n.username,l);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),a(Object(P.d)(P.a.dataDesync));case 12:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement(h.a,{text:"Your songs"}),r.a.createElement(g.a,{className:e.list},0!==t.length?r.a.createElement(H,{songs:t,onSortEnd:o,useWindowAsScrollContainer:!0,useDragHandle:!0}):r.a.createElement("p",null,"No songs found")),r.a.createElement(f.a,{className:e.addSongButton,variant:"contained",color:"primary",startIcon:r.a.createElement(b.a,null),onClick:function(){a(Object(v.d)(p.a.getDefaultSong(n))).then((function(e){c.push("/songs/"+e.id),console.log("Redirected!")})).catch((function(){return console.log("Error creating song")}))}},"New song"))},U=n(252),X=n(235),Z=n(259),$=n(251),ee=n(78),te=n(25),ne=n(3),ae=n(63),re=Object(o.a)((function(e){return{section:{borderWidth:2,borderStyle:"solid",borderRadius:5,borderColor:e.palette.primary.main,padding:20,marginBottom:3,overflow:"auto",whiteSpace:"nowrap",backgroundColor:e.palette.background.paper},normalViewRoot:{marginTop:-12,marginBottom:-15},name:{marginTop:10},linesDiv:{marginTop:12,marginBottom:10},line:{marginBottom:5},editForm:{marginBottom:15},nameField:{marginBottom:10},bottomDiv:{display:"flex"},lineSubmitButton:{marginTop:10,marginBottom:-25},cloneButton:{marginTop:10,marginBottom:-25},deleteButton:{marginTop:10,marginBottom:-25,marginLeft:"auto"},dragHandle:{marginLeft:"auto",marginTop:10,marginBottom:-25}}})),ce=function(e){var t=e.songId,n=e.sectionId,c=Object(a.useState)(!1),o=Object(y.a)(c,2),l=o[0],i=o[1],u=re(),s=Object(E.b)(),m=Object(O.c)((function(){return r.a.createElement(j.a,{className:u.dragHandle}," ",r.a.createElement(C.a,null,r.a.createElement(M.a,null))," ")})),d=Object(E.c)((function(e){return e.songs.find((function(e){return e.id===t})).sections.find((function(e){return e.id===n}))})),g=Object(E.c)((function(e){return e.errors.find((function(e){return e.type===ae.c.SECTION_NAME_ERROR&&e.id===n}))})),b=Object(E.c)((function(e){return e.errors.find((function(e){return e.type===ae.c.SECTION_LINES_ERROR&&e.id===n}))})),h=Object(E.c)((function(e){return e.statuses.editMode})),k=Object(E.c)((function(e){return e.statuses.chords})),N=Object(E.c)((function(e){return e.statuses.darkMode})),w=function(e){if("Tab"===e.key&&!e.shiftKey){e.preventDefault();var t=e.target.value,n=e.target.selectionStart,a=e.target.selectionEnd;e.target.value=t.substring(0,n)+"    "+t.substring(a),e.target.selectionStart=a+4-(a-n),e.target.selectionEnd=a+4-(a-n)}},x=function(e){return e.replace(/ /g,"\xa0")},R=function(e){var a=e.target.value,r=Object(ne.a)(Object(ne.a)({},d),{},{lines:Object(te.a)(d.lines),name:a});0===a.length||a.length>50?s(Object(ae.a)(ae.c.SECTION_NAME_ERROR,n)):s(Object(ae.d)(ae.c.SECTION_NAME_ERROR,n)),s(Object(v.h)(t,r))},T=function(e){var a=p.a.linesStringToArray(e.target.value),r=Object(ne.a)(Object(ne.a)({},d),{},{lines:a});p.a.validateLines(a)?s(Object(ae.d)(ae.c.SECTION_LINES_ERROR,n)):s(Object(ae.a)(ae.c.SECTION_LINES_ERROR,n)),s(Object(v.h)(t,r))},I=function(){console.log("Cloning",d),s(Object(v.b)(t,d))},B=function(e){e.preventDefault(),console.log("Delete button pressed!"),l?(console.log("Delete for realz"),s(Object(v.f)(t,d))):i(!0)};return r.a.createElement("div",{className:u.section},h?r.a.createElement("form",{className:u.editForm},r.a.createElement(U.a,{className:u.nameField,error:void 0!==g,label:"Edit name",name:"name",defaultValue:d.name,onChange:R,helperText:g?"Length must be 1-50 characters":""}),r.a.createElement("div",null,r.a.createElement(U.a,{multiline:!0,error:void 0!==b,label:"Lines",name:"lines",rows:d.lines.size,defaultValue:p.a.linesArrayToString(d.lines),onChange:T,fullWidth:!0,helperText:b?"Max 200 characters for one line":"",onKeyDown:w})),r.a.createElement("div",{className:u.bottomDiv},r.a.createElement(f.a,{className:u.cloneButton,size:"small",color:"primary",variant:N?"contained":"outlined",onClick:I},"Clone"),r.a.createElement(m,null),r.a.createElement(f.a,{className:u.deleteButton,size:"small",color:"secondary",variant:N?"contained":"outlined",onClick:B},l?"Confirm deletion":"Delete"))):r.a.createElement("div",{className:u.normalViewRoot},r.a.createElement(S.a,{variant:"h6",className:u.name},d.name),r.a.createElement("div",{className:u.linesDiv},d.lines.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement(S.a,{variant:"body1",className:u.line},k?p.a.addChordsToLine(e):x(e)))})))))},oe=Object(O.b)((function(e){var t=e.section,n=e.song;return r.a.createElement(ce,{songId:n.id,sectionId:t.id})})),le=Object(O.a)((function(e){var t=e.song;return r.a.createElement(l.a,{maxWidth:!1,align:"left"},t.sections.map((function(e,n){return r.a.createElement(oe,{key:e.id,index:n,section:e,song:t})})))})),ie=function(e){var t=e.song,n=Object(E.b)(),a=function(e){var a=e.oldIndex,r=e.newIndex,c=J()(t.sections,a,r);n(Object(v.m)(t,c))};return 0===t.sections.length?r.a.createElement(l.a,null,r.a.createElement("h2",null,"No sections")):r.a.createElement(le,{song:t,onSortEnd:a,useDragHandle:!0,useWindowAsScrollContainer:!0})},ue=n(218),se=n.n(ue),me=n(258),de=n(219),ge=n.n(de),fe=n(250),Ee=Object(o.a)((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),be=function(e){var t=e.onClick,n=Ee();return r.a.createElement(N.a,{className:n.closeButton,onClick:t},r.a.createElement(fe.a,null))},pe=function(e){var t=e.handleSaveConfirmClick,n=e.handleSaveDiscardClick,a=e.unsavedChanges,c=e.saveAllowed,o=void 0===c||c,l=function(e){return r.a.createElement(f.a,{onClick:u(e),color:"primary",variant:"contained"},"Save and leave")},i=function(e){return r.a.createElement(me.a,{title:"Resolve errors before saving",arrow:!0},r.a.createElement("span",null," ",r.a.createElement(f.a,{onClick:u(e),color:"primary",variant:"contained",disabled:!0},"Can't save")))},u=function(e){return function(){t(),e()}},s=function(e){return function(){n(),e()}};return r.a.createElement(ge.a,{when:a()},(function(e){return function(e,t,n){return r.a.createElement(T.a,{open:e,onClose:t},r.a.createElement(I.a,null,"You have unsaved changes"),r.a.createElement(B.a,null,r.a.createElement(D.a,null,"If you leave without saving, all changes will be lost!")),r.a.createElement(L.a,null,o?l(n):i(n),r.a.createElement(f.a,{onClick:s(n),color:"secondary",variant:"contained"},"Leave without saving"),r.a.createElement(be,{onClick:t})))}(e.isActive,e.onCancel,e.onConfirm)}))},ve=function(e){var t=e.open,n=e.setOpen,a=e.handleConfirmClick,c=e.handleDiscardClick,o=e.saveAllowed,l=void 0===o||o;return r.a.createElement(T.a,{open:t,onClose:function(){return n(!1)}},r.a.createElement(I.a,null,"Save changes?"),r.a.createElement(B.a,null,r.a.createElement(D.a,null,"Save or discard the changes you have made.")),r.a.createElement(L.a,null,l?r.a.createElement(f.a,{onClick:a,color:"primary",variant:"contained"},"Save changes"):r.a.createElement(me.a,{title:"Resolve errors before saving",arrow:!0},r.a.createElement("span",null," ",r.a.createElement(f.a,{onClick:a,color:"primary",variant:"contained",disabled:!0},"Can't save"))),r.a.createElement(f.a,{onClick:c,color:"secondary",variant:"contained"},"Discard changes"),r.a.createElement(be,{onClick:function(){return n(!1)}})))},he=n(60),Oe=Object(o.a)((function(e){return{root:{},menuContainer:{marginBottom:e.spacing(1),display:"flex",justifyContent:"flex-end"},chordToggleSwitch:{marginRight:"auto"},editModeSwitch:{marginLeft:e.spacing(1)},titleField:{marginTop:20,marginBottom:3},addSectionButton:{marginTop:e.spacing(1)},deleteSongButton:{marginLeft:"auto"},dialogCloseButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),je=function(){var e=Object(a.useState)(!1),t=Object(y.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),i=Object(y.a)(o,2),s=i[0],m=i[1],d=Oe(),g=Object(u.m)().id,p=Object(E.b)(),O=Object(u.k)(),j=Object(E.c)((function(e){return e.songs.find((function(e){return e.id===g}))})),C=Object(E.c)((function(e){return e.errors})),k=C.find((function(e){return e.type===ae.c.SONG_TITLE_ERROR})),S=Object(E.c)((function(e){return e.statuses.editMode})),N=Object(E.c)((function(e){return e.statuses.chords})),w=Object(E.c)((function(e){return e.statuses.darkMode})),x=Object(E.c)((function(e){return e.snapshot}));Object(a.useEffect)((function(){return p(Object(ee.b)()),function(){p(Object(he.b)())}}),[p]),console.log("Song render:",j);var R=function(){p(Object(he.c)())},T=function(){p(Object(ee.c)(j)),p(Object(v.l)(j))},I=function(){S?D():B()},B=function(){p(Object(ee.c)(j)),p(Object(he.e)())},D=function(){console.log("Exiting edit mode"),F()?m(!0):(p(Object(he.e)()),p(Object(ee.b)()))},L=function(){console.log("Saving!"),m(!1),p(Object(he.e)()),p(Object(ee.b)()),p(Object(v.l)(j))},A=function(){console.log("Discarding changes!"),m(!1),p(Object(he.e)()),p(Object(v.j)(x)),p(Object(ee.b)())},W=function(e){""===e.target.value||e.target.value.length>50?(console.log("Dispatching error"),p(Object(ae.a)(ae.c.SONG_TITLE_ERROR))):k&&(console.log("Removing errors"),p(Object(ae.d)(ae.c.SONG_TITLE_ERROR))),p(Object(v.i)(j,e.target.value))},M=function(){console.log("Add new section!"),p(Object(v.a)(j))},F=function(){return!se.a.isEmpty(x)&&!se.a.isEqual(x,j)};return j?r.a.createElement("div",{className:d.root},S?r.a.createElement("div",{style:{width:"".concat(5+j.title.length/2.5,"%")}},r.a.createElement(U.a,{fullWidth:!0,error:void 0!==k,className:d.titleField,label:"Edit title",defaultValue:j.title,onChange:W,helperText:k?"Length must be 1-50 characters":""})):r.a.createElement(h.a,{text:j.title}),r.a.createElement("div",null,r.a.createElement("div",{className:d.menuContainer},function(){if(!S)return r.a.createElement(X.a,{control:r.a.createElement(Z.a,{checked:N,onChange:R,color:"primary"}),label:"Show chords",className:d.chordToggleSwitch})}(),function(){if(F())return r.a.createElement(f.a,{color:"primary",variant:w?"contained":"outlined",onClick:T,disabled:0!==C.length},"Save changes")}(),r.a.createElement(X.a,{control:r.a.createElement(Z.a,{checked:S,onChange:I,color:"primary"}),label:"Edit mode",className:d.editModeSwitch})),r.a.createElement(ie,{song:j})),r.a.createElement(l.a,{maxWidth:!1},S?r.a.createElement(f.a,{className:d.addSectionButton,variant:"contained",color:"primary",startIcon:r.a.createElement(b.a,null),onClick:M},"New section"):r.a.createElement("div",null)),r.a.createElement(l.a,{align:"right",maxWidth:!1},S?r.a.createElement(f.a,{className:d.deleteSongButton,variant:"contained",color:"secondary",startIcon:r.a.createElement($.a,null),onClick:function(){return c(!0)}},"Delete song"):r.a.createElement("div",null)),r.a.createElement(_,{open:n,setOpen:c,handleConfirmClick:function(){console.log("Deleting song here"),p(Object(v.g)(j)),p(Object(ee.b)()),O.push("/songs/")}}),r.a.createElement(ve,{open:s,setOpen:m,handleConfirmClick:L,handleDiscardClick:A,saveAllowed:0===C.length}),r.a.createElement(pe,{handleSaveConfirmClick:L,handleSaveDiscardClick:A,unsavedChanges:F,saveAllowed:0===C.length})):r.a.createElement("div",null,r.a.createElement(h.a,{text:"Loading song"}),r.a.createElement("p",null,"Check the url if it takes too long"))},Ce=Object(o.a)((function(){return{mainContainer:{justifyContent:"center",alignItems:"center",padding:20},contentContainer:{}}}));t.default=function(){console.log("App rendering");var e=Ce(),t=Object(E.b)(),n=Object(E.c)((function(e){return e.auth.user}));return Object(a.useEffect)((function(){console.log("App effect"),t(Object(v.k)(n))}),[t,n]),r.a.createElement(r.a.Fragment,null,r.a.createElement(i.BrowserRouter,null,r.a.createElement(c.a,{loggedIn:!0}),r.a.createElement(l.a,{maxWidth:!1,className:e.mainContainer},r.a.createElement(l.a,{maxWidth:"lg",align:"center",className:e.contentContainer},r.a.createElement(u.g,null,r.a.createElement(u.d,{path:"/songs/:id"},r.a.createElement(je,null)),r.a.createElement(u.d,{path:"/songs/"},r.a.createElement(Q,null)),r.a.createElement(u.d,{path:"/"},r.a.createElement("p",null,"Welcome")))))))}}}]);
//# sourceMappingURL=5.8b4a0ff2.chunk.js.map