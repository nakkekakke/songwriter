(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[5],{150:function(e,n,t){"use strict";var a=t(0),r=t.n(a),o=t(134),c=t(138),l=Object(o.a)((function(){return{header:{marginTop:30}}}));n.a=function(e){var n=e.text,t=l();return r.a.createElement(c.a,{component:"h1",variant:"h4",className:t.header},n)}},155:function(e,n,t){"use strict";var a=t(3),r=t.n(a),o=t(9),c=t(38),l=t.n(c),i=t(52),u="/api/users",s=function(){var e=Object(o.a)(r.a.mark((function e(n,t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.post(u,{username:n,password:t});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),m=function(){var e=Object(o.a)(r.a.mark((function e(n){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.post(u+"/username-available",{username:n});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.a)(r.a.mark((function e(n,t){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.map((function(e){return e.id})),e.next=3,l.a.put(u+"/songs",{username:n,songIds:a},{headers:Object(i.a)()});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();n.a={create:s,usernameAvailable:m,editSongs:d}},156:function(e,n,t){"use strict";var a=t(0),r=t.n(a),o=t(203),c=t(204),l=t(138),i=t(134),u=t(202),s=t(19),m=t(23),d=t(147),g=t(13),f=function(e){var n=e.loggedIn,t=Object(s.b)(),a=Object(d.k)();return r.a.createElement(u.a,{color:"inherit",onClick:function(){n&&(t(Object(m.e)()),t(Object(g.d)(g.a.logout))),a.push("/")}},n?"Log out":"Log in")},E=t(148),b=Object(i.a)((function(){return{navButton:{textDecoration:"none",color:"white",padding:20}}})),v=function(e){var n=e.path,t=e.text,a=e.onClick,o=b();return r.a.createElement(u.a,{component:E.Link,to:n,onClick:a,color:"inherit",className:o.navButton},t)},p=Object(i.a)((function(){return{root:{flex:1}}})),O=function(e){var n=e.loggedIn,t=p();return r.a.createElement("div",{className:t.root},n?r.a.createElement(v,{path:"/songs/",text:"Your songs"}):void 0)},h=Object(i.a)((function(){return{root:{flexGrow:1},title:{fontSize:20,paddingRight:15}}}));n.a=function(e){var n=e.loggedIn,t=h();return r.a.createElement("div",{className:t.root},r.a.createElement(o.a,{position:"static"},r.a.createElement(c.a,null,r.a.createElement(l.a,{className:t.title},"SongWriter"),r.a.createElement(O,{loggedIn:n}),r.a.createElement(f,{loggedIn:n}))))}},221:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(156),c=t(134),l=t(136),i=t(148),u=t(147),s=t(3),m=t.n(s),d=t(9),g=t(211),f=t(202),E=t(19),b=t(216),v=t(46),p=t(48),O=t(150),h=t(153),j=t(220),C=t(214),k=t(213),N=t(138),S=t(152),y=t(142),x=t(188),w=t(212),R=t(210),I=t(224),B=t(206),T=t(207),D=t(208),L=t(209),_=function(e){var n=e.open,t=e.setOpen,a=e.handleConfirmClick;return r.a.createElement(I.a,{open:n,onClose:function(){return t(!1)}},r.a.createElement(B.a,null,"Delete this song?"),r.a.createElement(T.a,null,r.a.createElement(D.a,null,"Once deleted, this song cannot be restored.")),r.a.createElement(L.a,null,r.a.createElement(f.a,{onClick:a,color:"secondary",variant:"contained"},"Delete permanently"),r.a.createElement(f.a,{onClick:function(){return t(!1)},variant:"contained"},"Cancel")))},A=Object(c.a)((function(){return{menu:{"& .MuiPaper-root":{}}}})),M=function(e){var n=e.song,t=Object(a.useState)(null),o=Object(S.a)(t,2),c=o[0],l=o[1],i=Object(a.useState)(!1),u=Object(S.a)(i,2),s=u[0],m=u[1],d=A(),g=Object(E.b)(),b=Object(E.c)((function(e){return e.auth.user})),v=function(){l(null)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(y.a,{onClick:function(e){l(e.target)}},r.a.createElement(R.a,null)),r.a.createElement(x.a,{elevation:1,anchorEl:c,keepMounted:!0,open:null!==c,onClose:v,className:d.menu},r.a.createElement(w.a,null,r.a.createElement(f.a,{variant:"outlined",color:"primary",onClick:function(){g(Object(p.c)(n,b.username)),v()}},"Clone")),r.a.createElement(w.a,null,r.a.createElement(f.a,{variant:"outlined",color:"secondary",onClick:function(){m(!0),v()}},"Delete"))),r.a.createElement(_,{open:s,setOpen:m,handleConfirmClick:function(){g(Object(p.g)(n))}}))},W=t(215),F=Object(c.a)((function(){return{item:{},container:{display:"flex",justifyContent:"space-between"},title:{textAlign:"left",marginTop:8,marginBottom:8},menu:{}}})),z=Object(h.c)((function(){return r.a.createElement(j.a,{style:{marginTop:18,marginLeft:-12}}," ",r.a.createElement(C.a,null,r.a.createElement(W.a,null))," ")})),V=function(e){var n=e.song,t=F();return r.a.createElement(l.a,{maxWidth:"xl",className:t.container},r.a.createElement(z,null),r.a.createElement(k.a,{component:i.Link,to:"/songs/".concat(n.id),divider:!0,className:t.item},r.a.createElement(N.a,{variant:"h6",className:t.title},n.title)),r.a.createElement(M,{song:n,className:t.menu}))},G=Object(h.b)((function(e){var n=e.song;return r.a.createElement(V,{song:n})})),H=Object(h.a)((function(e){var n=e.songs;return r.a.createElement(l.a,{maxWidth:!1,align:"left"},n.map((function(e,n){return r.a.createElement(G,{key:e.id,index:n,song:e})})))})),Y=t(166),J=t.n(Y),q=t(155),P=Object(c.a)((function(){return{list:{marginTop:10},addSongButton:{margin:8}}})),K=function(){var e=P(),n=Object(E.c)((function(e){return e.songs})),t=Object(E.c)((function(e){return e.auth.user})),a=Object(E.b)(),o=Object(u.k)();console.log("Rendered",n.length,"songs");var c=function(){var e=Object(d.a)(m.a.mark((function e(r){var o,c,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.oldIndex,c=r.newIndex,l=J()(n,o,c),console.log("Sort ended"),a(Object(p.n)(l)),e.next=6,q.a.editSongs(t.username,l);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement(O.a,{text:"Your songs"}),r.a.createElement(g.a,{className:e.list},0!==n.length?r.a.createElement(H,{songs:n,onSortEnd:c,useWindowAsScrollContainer:!0,useDragHandle:!0}):r.a.createElement("p",null,"No songs found")),r.a.createElement(f.a,{className:e.addSongButton,variant:"contained",color:"primary",startIcon:r.a.createElement(b.a,null),onClick:function(){a(Object(p.d)(v.a.getDefaultSong(t))).then((function(e){o.push("/songs/"+e.id),console.log("Redirected!")})).catch((function(e){return console.log("Error creating new song:",e)}))}},"New song"))},Q=t(219),U=t(218),X=t(66),Z=t(25),$=t(5),ee=t(53),ne=Object(c.a)((function(e){return{section:{borderWidth:2,borderStyle:"solid",borderRadius:5,borderColor:e.palette.primary.main,padding:20,marginBottom:3,overflow:"auto",whiteSpace:"nowrap",backgroundColor:"#fff"},normalViewRoot:{marginTop:-12,marginBottom:-15},name:{marginTop:10},linesDiv:{marginTop:12,marginBottom:10},line:{marginBottom:5},editForm:{marginBottom:15},nameField:{marginBottom:10},bottomDiv:{display:"flex"},lineSubmitButton:{marginTop:10,marginBottom:-25},cloneButton:{marginTop:10,marginBottom:-25},deleteButton:{marginTop:10,marginBottom:-25,marginLeft:"auto"},dragHandle:{marginLeft:"auto",marginTop:10,marginBottom:-25}}})),te=function(e){var n=e.songId,t=e.sectionId,o=e.editMode,c=Object(a.useState)(!1),l=Object(S.a)(c,2),i=l[0],u=l[1],s=ne(),m=Object(E.b)(),d=Object(h.c)((function(){return r.a.createElement(j.a,{className:s.dragHandle}," ",r.a.createElement(C.a,null,r.a.createElement(W.a,null))," ")})),g=Object(E.c)((function(e){return e.songs.find((function(e){return e.id===n})).sections.find((function(e){return e.id===t}))})),b=Object(E.c)((function(e){return e.errors.find((function(e){return e.type===ee.c.SECTION_NAME_ERROR&&e.id===t}))})),O=Object(E.c)((function(e){return e.errors.find((function(e){return e.type===ee.c.SECTION_LINES_ERROR&&e.id===t}))})),k=function(e){var a=e.target.value,r=Object($.a)(Object($.a)({},g),{},{lines:Object(Z.a)(g.lines),name:a});0===a.length||a.length>50?m(Object(ee.a)(ee.c.SECTION_NAME_ERROR,t)):m(Object(ee.d)(ee.c.SECTION_NAME_ERROR,t)),m(Object(p.h)(n,r))},y=function(e){var a=v.a.linesStringToArray(e.target.value),r=Object($.a)(Object($.a)({},g),{},{lines:a});v.a.validateLines(a)?m(Object(ee.d)(ee.c.SECTION_LINES_ERROR,t)):m(Object(ee.a)(ee.c.SECTION_LINES_ERROR,t)),m(Object(p.h)(n,r))},x=function(){console.log("Cloning",g),m(Object(p.b)(n,g))},w=function(e){e.preventDefault(),console.log("Delete button pressed!"),i?(console.log("Delete for realz"),m(Object(p.f)(n,g))):u(!0)};return r.a.createElement("div",{className:s.section},o?r.a.createElement("form",{className:s.editForm},r.a.createElement(Q.a,{className:s.nameField,error:void 0!==b,label:"Edit name",name:"name",defaultValue:g.name,onChange:k,helperText:b?"Length must be 1-50 characters":""}),r.a.createElement("div",null,r.a.createElement(Q.a,{multiline:!0,error:void 0!==O,label:"Lines",name:"lines",rows:g.lines.size,defaultValue:v.a.linesArrayToString(g.lines),onChange:y,fullWidth:!0,helperText:O?"Max 200 characters for one line":""})),r.a.createElement("div",{className:s.bottomDiv},r.a.createElement(f.a,{className:s.cloneButton,size:"small",color:"primary",variant:"outlined",onClick:x},"Clone"),r.a.createElement(d,null),r.a.createElement(f.a,{className:s.deleteButton,size:"small",color:"secondary",variant:"outlined",onClick:w},i?"Confirm deletion":"Delete"))):r.a.createElement("div",{className:s.normalViewRoot},r.a.createElement(N.a,{variant:"h6",className:s.name},g.name),r.a.createElement("div",{className:s.linesDiv},g.lines.map((function(e,n){return r.a.createElement("div",{key:n},r.a.createElement(N.a,{variant:"body1",className:s.line},e))})))))},ae=Object(h.b)((function(e){var n=e.section,t=e.song,a=e.editMode;return r.a.createElement(te,{songId:t.id,sectionId:n.id,editMode:a})})),re=Object(h.a)((function(e){var n=e.song,t=e.editMode;return r.a.createElement(l.a,{maxWidth:!1,align:"left"},n.sections.map((function(e,a){return r.a.createElement(ae,{key:e.id,index:a,section:e,song:n,editMode:t})})))})),oe=function(e){var n=e.song,t=e.editMode,a=Object(E.b)(),o=function(e){var t=e.oldIndex,r=e.newIndex,o=J()(n.sections,t,r);a(Object(p.m)(n,o))};return 0===n.sections.length?r.a.createElement(l.a,null,r.a.createElement("h2",null,"No sections")):r.a.createElement(re,{song:n,editMode:t,onSortEnd:o,useDragHandle:!0,useWindowAsScrollContainer:!0})},ce=t(184),le=t.n(ce),ie=t(225),ue=t(186),se=t.n(ue),me=t(217),de=Object(c.a)((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),ge=function(e){var n=e.onClick,t=de();return r.a.createElement(y.a,{className:t.closeButton,onClick:n},r.a.createElement(me.a,null))},fe=function(e){var n=e.handleSaveConfirmClick,t=e.handleSaveDiscardClick,a=e.unsavedChanges,o=e.saveAllowed,c=void 0===o||o,l=function(e){return r.a.createElement(f.a,{onClick:u(e),color:"primary",variant:"contained"},"Save and leave")},i=function(e){return r.a.createElement(ie.a,{title:"Resolve errors before saving",arrow:!0},r.a.createElement("span",null," ",r.a.createElement(f.a,{onClick:u(e),color:"primary",variant:"contained",disabled:!0},"Can't save")))},u=function(e){return function(){n(),e()}},s=function(e){return function(){t(),e()}};return r.a.createElement(se.a,{when:a()},(function(e){return function(e,n,t){return r.a.createElement(I.a,{open:e,onClose:n},r.a.createElement(B.a,null,"You have unsaved changes"),r.a.createElement(T.a,null,r.a.createElement(D.a,null,"If you leave without saving, all changes will be lost!")),r.a.createElement(L.a,null,c?l(t):i(t),r.a.createElement(f.a,{onClick:s(t),color:"secondary",variant:"contained"},"Leave without saving"),r.a.createElement(ge,{onClick:n})))}(e.isActive,e.onCancel,e.onConfirm)}))},Ee=function(e){var n=e.open,t=e.setOpen,a=e.handleConfirmClick,o=e.handleDiscardClick,c=e.saveAllowed,l=void 0===c||c;return r.a.createElement(I.a,{open:n,onClose:function(){return t(!1)}},r.a.createElement(B.a,null,"Save changes?"),r.a.createElement(T.a,null,r.a.createElement(D.a,null,"Save or discard the changes you have made.")),r.a.createElement(L.a,null,l?r.a.createElement(f.a,{onClick:a,color:"primary",variant:"contained"},"Save changes"):r.a.createElement(ie.a,{title:"Resolve errors before saving",arrow:!0},r.a.createElement("span",null," ",r.a.createElement(f.a,{onClick:a,color:"primary",variant:"contained",disabled:!0},"Can't save"))),r.a.createElement(f.a,{onClick:o,color:"secondary",variant:"contained"},"Discard changes"),r.a.createElement(ge,{onClick:function(){return t(!1)}})))},be=Object(c.a)((function(e){return{root:{},menuContainer:{marginBottom:e.spacing(1)},editModeButton:{marginLeft:e.spacing(1)},titleField:{margin:12},addSectionButton:{marginTop:e.spacing(1)},deleteSongButton:{marginLeft:"auto"},dialogCloseButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),ve=function(){var e=Object(a.useState)(!1),n=Object(S.a)(e,2),t=n[0],o=n[1],c=Object(a.useState)(!1),i=Object(S.a)(c,2),s=i[0],m=i[1],d=Object(a.useState)(!1),g=Object(S.a)(d,2),v=g[0],h=g[1],j=be(),C=Object(u.m)().id,k=Object(E.b)(),N=Object(u.k)(),y=Object(E.c)((function(e){return e.songs.find((function(e){return e.id===C}))})),x=Object(E.c)((function(e){return e.errors}));console.log("Errors:",x);var w=x.find((function(e){return e.type===ee.c.SONG_TITLE_ERROR})),R=Object(E.c)((function(e){return e.snapshot}));Object(a.useEffect)((function(){k(Object(X.b)())}),[k]),console.log("Song render:",y);var I=function(){k(Object(X.c)(y)),k(Object(p.l)(y))},B=function(){t?D():T()},T=function(){k(Object(X.c)(y)),o(!0)},D=function(){console.log("Exiting edit mode"),F()?h(!0):(o(!1),k(Object(X.b)()))},L=function(){console.log("Saving!"),h(!1),o(!1),k(Object(X.b)()),k(Object(p.l)(y))},A=function(){console.log("Discarding changes!"),h(!1),o(!1),k(Object(p.j)(R)),k(Object(X.b)())},M=function(e){""===e.target.value||e.target.value.length>50?(console.log("Dispatching error"),k(Object(ee.a)(ee.c.SONG_TITLE_ERROR))):w&&(console.log("Removing errors"),k(Object(ee.d)(ee.c.SONG_TITLE_ERROR))),k(Object(p.i)(y,e.target.value))},W=function(){console.log("Add new section!"),k(Object(p.a)(y))},F=function(){return!le.a.isEmpty(R)&&!le.a.isEqual(R,y)};return y?r.a.createElement("div",{className:j.root},t?r.a.createElement("div",{style:{width:"".concat(5+y.title.length/2.5,"%")}},r.a.createElement(Q.a,{fullWidth:!0,error:void 0!==w,className:j.titleField,label:"Edit title",defaultValue:y.title,onChange:M,helperText:w?"Length must be 1-50 characters":""})):r.a.createElement(O.a,{text:y.title}),r.a.createElement("div",null,r.a.createElement(l.a,{align:"right",maxWidth:!1,className:j.menuContainer},function(){if(F())return r.a.createElement(f.a,{color:"primary",variant:"outlined",onClick:I,disabled:0!==x.length},"Save changes")}(),r.a.createElement(f.a,{color:"primary",variant:"contained",onClick:B,className:j.editModeButton},t?"Exit edit mode":"Edit mode")),r.a.createElement(oe,{song:y,editMode:t})),r.a.createElement(l.a,{maxWidth:!1},t?r.a.createElement(f.a,{className:j.addSectionButton,variant:"contained",color:"primary",startIcon:r.a.createElement(b.a,null),onClick:W},"New section"):r.a.createElement("div",null)),r.a.createElement(l.a,{align:"right",maxWidth:!1},t?r.a.createElement(f.a,{className:j.deleteSongButton,variant:"contained",color:"secondary",startIcon:r.a.createElement(U.a,null),onClick:function(){return m(!0)}},"Delete song"):r.a.createElement("div",null)),r.a.createElement(_,{open:s,setOpen:m,handleConfirmClick:function(){console.log("Deleting song here"),k(Object(p.g)(y)),k(Object(X.b)()),N.push("/songs/")}}),r.a.createElement(Ee,{open:v,setOpen:h,handleConfirmClick:L,handleDiscardClick:A,saveAllowed:0===x.length}),r.a.createElement(fe,{handleSaveConfirmClick:L,handleSaveDiscardClick:A,unsavedChanges:F,saveAllowed:0===x.length})):r.a.createElement("div",null,r.a.createElement(O.a,{text:"Loading song"}),r.a.createElement("p",null,"Check the url if it takes too long"))},pe=Object(c.a)((function(){return{mainContainer:{justifyContent:"center",alignItems:"center",padding:20},contentContainer:{}}}));n.default=function(){console.log("App rendering");var e=pe(),n=Object(E.b)(),t=Object(E.c)((function(e){return e.auth.user}));return Object(a.useEffect)((function(){console.log("App effect"),n(Object(p.k)(t))}),[n,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(i.BrowserRouter,null,r.a.createElement(o.a,{loggedIn:!0}),r.a.createElement(l.a,{maxWidth:!1,className:e.mainContainer},r.a.createElement(l.a,{maxWidth:!1,align:"center",className:e.contentContainer},r.a.createElement(u.g,null,r.a.createElement(u.d,{path:"/songs/:id"},r.a.createElement(ve,null)),r.a.createElement(u.d,{path:"/songs/"},r.a.createElement(K,null)),r.a.createElement(u.d,{path:"/"},r.a.createElement("p",null,"Welcome")))))))}}}]);
//# sourceMappingURL=5.c5161d9f.chunk.js.map